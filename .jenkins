#!/usr/bin/env groovy


// Include this shared CI repository to load script helpers and libraries.
library identifier: 'vapor@master', retriever: modernSCM([
  $class: 'GitSCMSource',
  remote: 'https://github.com/vapor-ware/ci-shared.git',
  credentialsId: 'vio-bot-gh',
])


golangPipeline([
  'image': 'vaporio/snmp-plugin',
  'podTemplate': """
    apiVersion: v1
    kind: Pod
    metadata:
      labels:
        jenkins/job: synse-snmp-plugin
    spec:
      containers:
      - name: go
        image: vaporio/jenkins-agent-golang:latest
        command:
        - cat
        tty: true
        securityContext:
          runAsUser: 1000
          runAsGroup: 998
        volumeMounts:
        - name: docker-sock
          mountPath: /var/run/docker.sock
        - name: docker-bin
          mountPath: /usr/bin/docker
      - name: emulator
        image: vaporio/snmp-emulator:etd-test
        imagePullPolicy: Always
        tty: true
        args:
        - --data-dir=./data
        - --agent-udpv4-endpoint=0.0.0.0:1024
        - --v3-user=simulator
        - --v3-auth-key=auctoritas
        - --v3-auth-proto=SHA
        - --v3-priv-key=privatus
        - --v3-priv-proto=AES
      volumes:
      - name: docker-sock
        hostPath:
          path: /var/run/docker.sock
      - name: docker-bin
        hostPath:
          path: /usr/bin/docker
  """,
])
